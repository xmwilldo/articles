# 蓝绿部署、AB测试、灰度发布(金丝雀发布)

Created: March 4, 2021
Created by: William Wang
Tags: Study

# 蓝绿部署

蓝绿发布是指同事运行两个版本的应用，如下图所示，新老版本共存，等到新版本的实例数全部运行起来以后再把流量全部切到新版本上。这种部署方式需要新旧两个版本的实例数共存，所以有点浪费资源。

![%E8%93%9D%E7%BB%BF%E9%83%A8%E7%BD%B2%E3%80%81AB%E6%B5%8B%E8%AF%95%E3%80%81%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83(%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83)%204dec6365e94c46d7b1daf6ed2f8915c9/Untitled.png](%E8%93%9D%E7%BB%BF%E9%83%A8%E7%BD%B2%E3%80%81AB%E6%B5%8B%E8%AF%95%E3%80%81%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83(%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83)%204dec6365e94c46d7b1daf6ed2f8915c9/Untitled.png)

# 滚动发布

滚动发布是解决上面蓝绿部署对资源要求倍增的问题。滚动升级是指我的应用的实例数始终保持一个不变的数，就意味着我只要运行起一个新版本的实例那么久要停止一个旧版本的应用实例直到应用实例全部更新为新的版本。

但是滚动发布还有有问题，那就是这里没有流量控制，不能保证新版本一定可用，所以不对新版本做流量控制是不合适的。整个系统会处于一个很不稳定的状态。

![%E8%93%9D%E7%BB%BF%E9%83%A8%E7%BD%B2%E3%80%81AB%E6%B5%8B%E8%AF%95%E3%80%81%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83(%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83)%204dec6365e94c46d7b1daf6ed2f8915c9/Untitled%201.png](%E8%93%9D%E7%BB%BF%E9%83%A8%E7%BD%B2%E3%80%81AB%E6%B5%8B%E8%AF%95%E3%80%81%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83(%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83)%204dec6365e94c46d7b1daf6ed2f8915c9/Untitled%201.png)

# 灰度发布(金丝雀发布)

灰度发布又称金丝雀发布，就是为了解决上面滚动发布的问题，就是我在发布新版本的时候带上对新版本的流量控制，刚开始只切换一小部分流量到新版本实例上进行测试和试运行，带到这个新版本的稳定性已经是一个可靠的程度和这个新版本的可行性得到肯定以后在逐步地用新版本替换旧版本并且逐渐增大新版本的流量，知道新版本的处理流量达到100%，发布完成。如果发布中途发现新版本的严重缺陷则可以再把流量切到旧版本上。

![%E8%93%9D%E7%BB%BF%E9%83%A8%E7%BD%B2%E3%80%81AB%E6%B5%8B%E8%AF%95%E3%80%81%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83(%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83)%204dec6365e94c46d7b1daf6ed2f8915c9/Untitled%202.png](%E8%93%9D%E7%BB%BF%E9%83%A8%E7%BD%B2%E3%80%81AB%E6%B5%8B%E8%AF%95%E3%80%81%E7%81%B0%E5%BA%A6%E5%8F%91%E5%B8%83(%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83)%204dec6365e94c46d7b1daf6ed2f8915c9/Untitled%202.png)

# A/B测试

A/B测试跟上述的部署方式没有什么直接联系，它指的是测试应用的功能表现的方法，例如可用性、受欢迎程度、可见性等等，通过分割小流量测试等方式来获得一些关键性指标来指导新版本的功能是否合适推广到全部流量。